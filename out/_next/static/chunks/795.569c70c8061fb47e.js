"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[795],{6795:function(e,t,a){a.r(t),a.d(t,{default:function(){return x}});var n=a(7437),l=a(8059),o=a.n(l),r=a(7818);a(966);var s=a(2265);a(1908);var i=a(8069),d=a(317),c=e=>{let{fullScreen:t=!1,message:a="Loading data..."}=e;return(0,n.jsxs)("div",{style:t?{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(5px)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:1e4}:{position:"fixed",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(5px)",zIndex:9999},className:"jsx-3941084e5983ed61",children:[(0,n.jsx)("div",{className:"jsx-3941084e5983ed61 spinner-container",children:(0,n.jsx)("div",{className:"jsx-3941084e5983ed61 spinner"})}),(0,n.jsx)("p",{className:"jsx-3941084e5983ed61 loading-message",children:a}),(0,n.jsx)(o(),{id:"3941084e5983ed61",children:".spinner-container.jsx-3941084e5983ed61{margin-bottom:1rem}.spinner.jsx-3941084e5983ed61{width:50px;height:50px;border:5px solid rgba(38,166,154,.3);-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;border-top-color:#26A69A;-webkit-animation:spin 1s ease-in-out infinite;-moz-animation:spin 1s ease-in-out infinite;-o-animation:spin 1s ease-in-out infinite;animation:spin 1s ease-in-out infinite}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{to{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{to{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{to{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}.loading-message.jsx-3941084e5983ed61{font-size:1.1rem;color:#00695C;font-weight:500;margin:1rem 0 0;text-align:center}"})]})};let p=(0,r.default)(()=>Promise.all([a.e(212),a.e(143)]).then(a.bind(a,143)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[143]},ssr:!1,loading:()=>(0,n.jsx)("div",{children:"Loading map component..."})}),u=(0,r.default)(()=>Promise.all([a.e(212),a.e(143)]).then(a.bind(a,143)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[143]},ssr:!1}),g=(0,r.default)(()=>Promise.all([a.e(212),a.e(143)]).then(a.bind(a,143)).then(e=>e.Circle),{loadableGenerated:{webpack:()=>[143]},ssr:!1}),f=(0,r.default)(()=>Promise.all([a.e(212),a.e(143)]).then(a.bind(a,143)).then(e=>e.Popup),{loadableGenerated:{webpack:()=>[143]},ssr:!1}),m=(0,r.default)(()=>Promise.all([a.e(212),a.e(143)]).then(a.bind(a,143)).then(e=>e.useMap),{loadableGenerated:{webpack:()=>[143]},ssr:!1}),h=(0,s.forwardRef)((e,t)=>{let{selectedCountry:a="all",yearRange:l,selectedProduct:r="all",selectedCategory:h,zoom:x,setZoom:b}=e,[w,j]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{j(!0)},[]),!w)return(0,n.jsx)(c,{message:"Loading..."});let[y,k]=(0,s.useState)(!1),[z,v]=(0,s.useState)(null),[N,C]=(0,s.useState)([]),E=(0,s.useRef)(null),{allProducts:L,loading:P,error:S,selectedProduct:M}=(0,i.rn)(),{searchResults:F,setMarkerSelected:_}=(0,d.R)(),I=F||[];(0,s.useImperativeHandle)(t,()=>({centerOnLocation:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8;E.current&&E.current.setView([e,t],a)},getLocationByProduct:e=>N.find(t=>(t.product||"").toLowerCase()===e.toLowerCase())})),(0,s.useEffect)(()=>{if(P||k(!0),!P&&!S){console.log("Processing product data for map...");let e=I&&I.length>0?I:L||[];if(console.log("Map preparing to show ".concat(e.length," products")),e.length>0){let t={};e.forEach(e=>{let a=e.geo||"undefined";t[a]=(t[a]||0)+1}),console.log("Map geo distribution:",t)}if(e.length>0){let t=e;e.length>1e3&&(console.warn("Too many products (".concat(e.length,"), limiting to ").concat(1e3," for performance")),t=e.slice(0,1e3));let a=t.map(e=>!e.lat||!e.lng||isNaN(parseFloat(e.lat))||isNaN(parseFloat(e.lng))?(console.warn("Product missing valid coordinates: ".concat(e.name)),null):{lat:parseFloat(e.lat),lng:parseFloat(e.lng),country:e.country||"Unknown",refYear:e.ref_year||e.refYear||"all",validUntil:e.valid_until||e.validUntil||"all",product:e.product_name||e.name||"Unnamed Product",description:e.description||"",isEpd:"EPD"===e.type?"EPD":null,categories:e.classific||e.category_name||"",geo:e.geo,geoMapped:e.geoMapped,productId:e.id||e.uid}).filter(e=>null!==e);console.log("Map has ".concat(a.length," valid locations to display")),a.length>0&&console.log("Sample location:",a[0]),C(a)}else console.warn("No products to display on map"),C([])}let e=setTimeout(()=>{k(!1),console.log("Map loading complete, displaying markers")},500);return()=>clearTimeout(e)},[L,I,P,S]),(0,s.useEffect)(()=>{if(!P&&L){console.log("Total products available: ".concat(L.length));let e={};L.forEach(t=>{let a=t.geo||"undefined";e[a]=(e[a]||0)+1}),console.log("Geo field distribution:",e);let t=L.filter(e=>e.lat&&e.lng);console.log("Products with coordinates: ".concat(t.length,"/").concat(L.length)),t.length>0&&console.log("Sample products with coordinates:",t.slice(0,3));let a=L.filter(e=>!e.lat||!e.lng);a.length>0&&console.log("Sample products without coordinates:",a.slice(0,3))}},[L,P]);let A=y||P,D=P?"Loading product data...":"Processing locations...";(0,s.useEffect)(()=>{console.log("Loading state:",{componentLoading:y,productsLoading:P,isLoading:A})},[y,P,A]);let R=e=>e.reduce((e,t)=>(e[t.country]||(e[t.country]=[]),e[t.country].push(t),e),{}),T=(e,t,a,n)=>{var l=2;l=2;let o=2*Math.PI/a;return Array.from({length:a},(a,n)=>{let r=n*o,s=Math.random()*l;return{lat:e+s*Math.cos(r),lng:t+s*Math.sin(r)}})},U=(e,t)=>Object.values(R(e)).flatMap(e=>e.map((a,n)=>{let l=e[0],o=T(l.lat,l.lng,e.length,t);return{...a,lat:o[n].lat,lng:o[n].lng}})),G=(()=>{if(console.log("Total locations before filtering:",N.length),console.log("Filtered products from search:",I.length),console.log("Selected Product:",M),!N||0===N.length)return console.log("No locations available"),[];let e=N.filter(e=>{if(!e||!e.product)return!1;if(I&&I.length>0)return I.some(t=>{let a=t.product_name||t.name||"",n=e.product||"";if(a===n)return console.log('Product match found: "'.concat(a,'" === "').concat(n,'"')),!0;if("zehnder-basic-silent-wall-fan"===a&&(n.includes("silent-wall")||n.includes("basic-silent")||n.includes("wall-fan")))return console.log('Special match found for zehnder-basic-silent-wall-fan: "'.concat(n,'"')),!0;if(a.toLowerCase().includes("zehnder-")&&n.toLowerCase().includes("zehnder-")){let e=a.toLowerCase().split("zehnder-")[1],t=n.toLowerCase().split("zehnder-")[1],l=e.split("-"),o=t.split("-"),r=0;for(let e of l)o.includes(e)&&r++;let s=r/l.length;if(s>=.5)return console.log('Zehnder partial match found: "'.concat(a,'" ~= "').concat(n,'" (').concat(Math.round(100*s),"% match)")),!0;if(e===t)return console.log('Zehnder exact match found: "'.concat(a,'" === "').concat(n,'" (without prefix)')),!0}return!1});let t="all"===a||!a||e.country===a,n="all"===l[0]||"all"===l[1]||("all"===e.refYear||e.refYear>=l[0])&&("all"===e.validUntil||e.validUntil<=l[1]),o="all"===r||!r||e.product===r,s="all"===h||!h||e.categories&&("string"==typeof e.categories?e.categories.includes(h):Array.isArray(e.categories)&&e.categories.includes(h));return t&&n&&o&&s});return console.log("Filtered locations:",e.length),0===e.length?console.log("No locations matched the filters"):console.log("Sample filtered location:",e[0]),e})(),O=(0,s.useMemo)(()=>U(G,x),[G,x]),V=e=>e>3&&e<=5?6e5/(4*e):e>5&&e<=10?6e5/(20*e):e>10&&e<=15?5e3/e:e>15?100:15e4,[B,Y]=(0,s.useState)(null),Z=(0,s.useRef)(0);return(0,s.useEffect)(()=>{if(M&&N.length>0){let e=M.product_name||M.name;console.log("Selected product:",e,M);let t=null;if("zehnder-basic-silent-wall-fan"===e&&(console.log("Special handling for zehnder-basic-silent-wall-fan"),(t=N.find(e=>e.product&&(e.product.includes("silent-wall")||e.product.includes("basic-silent")||e.product.includes("wall-fan"))))&&console.log("Found similar product:",t.product)),t||(t=N.find(t=>t.product===e)),!t){let a=e.toLowerCase();t=N.find(e=>(e.product||"").toLowerCase()===a)}if(t)console.log("Found matching location:",t),Y(t),E.current&&E.current.setView([t.lat,t.lng],8);else if(console.warn("No matching location found for:",e),M.lat&&M.lng){let t={lat:parseFloat(M.lat),lng:parseFloat(M.lng),product:e,country:M.country||"Unknown",description:M.description||""};Y(t),E.current&&E.current.setView([t.lat,t.lng],8)}else Y(null)}else Y(null)},[M,N]),(0,s.useEffect)(()=>{0===I.length&&Z.current>0&&(console.log("Search results cleared, resetting map display"),Y(null),E.current&&E.current.setView([30,-10],3)),Z.current=I.length},[I]),(0,s.useEffect)(()=>{_(!!B)},[B,_]),(0,n.jsxs)(n.Fragment,{children:[w?(0,n.jsxs)(p,{center:[30,-10],zoom:3,style:{height:"100vh",width:"100%"},ref:E,maxBounds:[[-90,-180],[90,180]],children:[(0,n.jsx)(e=>{let{setZoom:t,zoom:a}=e,[n,l]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{l(!0)},[]),!n)return null;let o=m();return(0,s.useEffect)(()=>{E.current=o,o.setView(o.getCenter(),a)},[a,o]),(0,s.useEffect)(()=>{let e=()=>{t(o.getZoom())};return o.on("zoomend",e),()=>{o.off("zoomend",e)}},[o,t]),null},{setZoom:b,zoom:x,className:"jsx-d0a39a6dad4b7d07"}),(0,n.jsx)(u,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png"}),0===O.length&&!A&&(0,n.jsx)("div",{style:{position:"absolute",top:"10px",left:"50%",transform:"translateX(-50%)",zIndex:1,background:"rgba(255,255,255,0.8)",padding:"10px",borderRadius:"5px"},className:"jsx-d0a39a6dad4b7d07",children:"No markers to display. Check console for details."}),O.length>0&&(0,n.jsxs)("div",{style:{position:"absolute",top:"10px",right:"10px",zIndex:1,background:"rgba(255,255,255,0.8)",padding:"5px",borderRadius:"5px",fontSize:"12px"},className:"jsx-d0a39a6dad4b7d07",children:["Showing ",O.length," markers"]}),O.map((e,t)=>{let a=B&&e.lat===B.lat&&e.lng===B.lng,l=a?{fillColor:"#4DB6AC",color:"#00695C",weight:2,fillOpacity:.8}:{fillColor:e.isEpd?"#4DB6AC":"#00695C",color:e.isEpd?"#26A69A":"#004D40",weight:1,fillOpacity:.6};return(0,n.jsx)(g,{center:[e.lat,e.lng],radius:V(x),pathOptions:l,children:(0,n.jsx)(f,{children:(0,n.jsxs)("div",{style:{maxWidth:"250px"},className:"jsx-d0a39a6dad4b7d07",children:[(0,n.jsx)("h3",{className:"jsx-d0a39a6dad4b7d07",children:e.product}),(0,n.jsxs)("p",{className:"jsx-d0a39a6dad4b7d07",children:[(0,n.jsx)("strong",{className:"jsx-d0a39a6dad4b7d07",children:"Country:"})," ",e.country,a&&(0,n.jsx)("span",{style:{color:"red"},className:"jsx-d0a39a6dad4b7d07",children:" ★ Selected"})]}),e.isEpd&&(0,n.jsxs)("p",{className:"jsx-d0a39a6dad4b7d07",children:[(0,n.jsx)("strong",{className:"jsx-d0a39a6dad4b7d07",children:"Type:"})," ",e.isEpd]}),e.description&&(0,n.jsxs)("p",{className:"jsx-d0a39a6dad4b7d07",children:[(0,n.jsx)("strong",{className:"jsx-d0a39a6dad4b7d07",children:"Description:"})," ",e.description.substring(0,100),e.description.length>100?"...":""]})]})})},"".concat(e.lat,"-").concat(e.lng,"-").concat(t))})]}):(0,n.jsx)("div",{style:{height:"100vh",width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},className:"jsx-d0a39a6dad4b7d07",children:(0,n.jsx)(c,{message:"Loading map..."})}),A&&(0,n.jsx)(c,{message:D}),(0,n.jsx)(o(),{id:"d0a39a6dad4b7d07",children:".leaflet-popup{z-index:9999!important}.leaflet-popup-content-wrapper{-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;-webkit-box-shadow:0 4px 12px rgba(0,0,0,.15);-moz-box-shadow:0 4px 12px rgba(0,0,0,.15);box-shadow:0 4px 12px rgba(0,0,0,.15);background:rgba(255,255,255,.95);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.leaflet-popup-tip{background:rgba(255,255,255,.95)}.leaflet-pane{z-index:9000!important}.leaflet-popup-pane{z-index:9500!important}.leaflet-overlay-pane{z-index:8500!important}.leaflet-map-pane{z-index:800!important}.leaflet-tile-pane{z-index:500!important}.leaflet-marker-pane{z-index:600!important}.leaflet-shadow-pane{z-index:550!important}.leaflet-objects-pane{z-index:650!important}.leaflet-svg-pane{z-index:700!important}"})]})});h.displayName="MapComponent";var x=h}}]);